<table mat-table [dataSource]="methods"
    class="mat-elevation-z8 plan-entry" multiTemplateDataRows>
    <ng-container matColumnDef="methodName">
        <th mat-header-cell *matHeaderCellDef>รายละเอียด</th>
        <td mat-cell *matCellDef="let element; let i = dataIndex" [attr.rowspan]="4" class="text-left"
            style="padding-left: 15px !important;">
            {{element.data.methodName}}
        </td>
    </ng-container>
    <ng-container matColumnDef="year">
        <th mat-header-cell *matHeaderCellDef>ปี</th>
        <td mat-cell *matCellDef="let element" [attr.rowspan]="4">
            <div class="w-full">
                <mat-form-field class="w-full year-select">
                    <mat-select #yearSelect name="yearSelect" id="yearSelect" [value]="element.data.resultRecords[0] ? element.data.resultRecords[0].year: undefined">
                        <mat-option *ngFor="let year of getYears(element.data.resultRecords)" [value]="year">
                            {{year}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </td>
    </ng-container>
    <ng-container matColumnDef="targetHeader">
        <td mat-cell *matCellDef="let element" [attr.colspan]="12" class="bg-slate-300 header-text">เป้าหมาย</td>
    </ng-container>
    <ng-container matColumnDef="owner">
        <th mat-header-cell *matHeaderCellDef>ผู้รับผิดชอบ</th>
        <td mat-cell *matCellDef="let element" class="text-left" [attr.rowspan]="4">{{element.data.owner}}</td>
    </ng-container>
    <ng-container *ngFor="let col of methodRow2" [matColumnDef]="col">
        <th mat-header-cell *matHeaderCellDef>{{capitalizeFirstLetter(col)}}</th>
        <td mat-cell *matCellDef="let element; let i = dataIndex" class="text-month text-center bg-slate-300"
            [ngClass]="{
                'border border-solid border-white': col=='dec' 
            }">
            <ng-container *ngIf="yearSelects && getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value) && getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value)[col] != undefined; else blank">
                <a href="#" onClick="return false" class="text-month">P</a><br>
                {{subTargetSymbolValue}}
            </ng-container>
            <ng-template #blank></ng-template>
        </td>
    </ng-container>
    <ng-container matColumnDef="resultHeader">
        <td mat-cell *matCellDef="let element" [attr.colspan]="12" class="bg-slate-300 border border-solid border-white header-text">ทำได้จริง</td>
    </ng-container>
    <ng-container *ngFor="let col of methodRow4" [matColumnDef]="col">
        <td mat-cell *matCellDef="let element; let i = dataIndex" class="text-center"
            [ngClass]="{ 
                'bg-dark-green': yearSelects && getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value) && getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value)[col.replace('2','')] != undefined, 
                'border border-solid border-white': col=='dec2'
            }">
            <ng-container *ngIf="yearSelects && getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value) && getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value)[col.replace('2','')] != undefined; else blank">
                <mat-checkbox [color]="'primary'"></mat-checkbox>
                <a class="text-month" href="#" onClick="return false" (click)="openTargetEntryModal(yearSelects.toArray()[i]?.value, col.replace('2',''))">A</a><br>
                {{subTargetSymbolValue}}
            </ng-container>
            <ng-template #blank></ng-template>
        </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="methodHeader"></tr>
    <tr mat-row class="example-element-row header-row" *matRowDef="let element;let row;columns: methodRow1"></tr>
    <tr mat-row class="example-element-row result-row" *matRowDef="let element;let row;columns: methodRow2"></tr>
    <tr mat-row class="example-element-row header-row" *matRowDef="let element;let row;columns: methodRow3"></tr>
    <tr mat-row class="example-element-row result-row" *matRowDef="let element;let row;columns: methodRow4"></tr>
</table>