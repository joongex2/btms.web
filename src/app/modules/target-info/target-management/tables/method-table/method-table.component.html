<p class="table-title flex flex-row justify-between items-center">
    <span>รายละเอียด</span>
    <span class="flex items-center cursor-pointer" (click)="addMethod();">
        <mat-icon style="color:white" svgIcon="heroicons_outline:plus"></mat-icon>เพิ่มรายละเอียด
    </span>
</p>
<table mat-table [dataSource]="methods" multiTemplateDataRows #methodTable>
    <ng-container matColumnDef="methodName">
        <th mat-header-cell *matHeaderCellDef>ลำดับที่</th>
        <td mat-cell *matCellDef="let element; let i = dataIndex">
            {{element.data.methodName}}
        </td>
    </ng-container>
    <ng-container matColumnDef="year">
        <th mat-header-cell *matHeaderCellDef>ปี</th>
        <td mat-cell *matCellDef="let element; let i = dataIndex">
            <div class="w-full p-1">
                <mat-form-field class="w-full year-select">
                    <mat-select #yearSelect name="yearSelect" id="yearSelect" [value]="element.data.resultRecords[0] ? element.data.resultRecords[0].year: undefined">
                        <mat-option *ngFor="let year of getYears(element.data.resultRecords)" [value]="year">
                            {{year}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </td>
    </ng-container>
    <ng-container *ngFor="let col of monthColumns" [matColumnDef]="col">
        <th mat-header-cell *matHeaderCellDef>{{capitalizeFirstLetter(col)}}</th>
        <td mat-cell *matCellDef="let element; let i = dataIndex">
            <span class="w-full">
                <ng-container *ngIf="yearSelects">
                    {{getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value) ? 
                        getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value)[col] ?
                            getResultRecord(element.data.resultRecords, yearSelects.toArray()[i]?.value)[col].status 
                            : '-'
                        : '-'}}
                </ng-container>
            </span>
        </td>
    </ng-container>
    <ng-container matColumnDef="owner">
        <th mat-header-cell *matHeaderCellDef>ผู้รับผิดชอบ</th>
        <td mat-cell *matCellDef="let element; let i = dataIndex">
            {{element.data.owner}}
        </td>
    </ng-container>
    <ng-container matColumnDef="editIcon">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element; let i = dataIndex">
            <mat-icon (click)="editMethod(i);" svgIcon="heroicons_outline:pencil" class="w-3.5 min-w-3.5 cursor-pointer" title="แก้ไขรายละเอียด"></mat-icon>
        </td>
    </ng-container>
    <ng-container matColumnDef="deleteIcon">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element; let i = dataIndex">
            <mat-icon (click)="deleteMethod(i);" svgIcon="heroicons_outline:x" class="w-5 min-w-5 cursor-pointer" title="ลบรายละเอียด"></mat-icon>
        </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="normal-row"></tr>
</table>